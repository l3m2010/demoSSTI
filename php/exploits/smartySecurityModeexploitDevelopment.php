<?php


//README:
//I havn't been able do develop and exploit but this information may be usefull for future research

require 'smarty-3.1.30/libs/Smarty.class.php';

$smarty = new Smarty;
// enable default security
$smarty->enableSecurity();
//more security features can be added https://www.smarty.net/docs/en/advanced.features.tpl#advanced.features.security
$smarty->debugging = false;


$user_in = "{include file=\"string:{1+1}\"}";
$user_in = "{file:///proc/self/loginuid}";
$user_in = "{self::getStreamVariable(\"file:///proc/self/loginuid\")}";
$user_in = "{Smarty_Internal_Write_File}";
$user_in = "{\$file:index}";
$user_in = "{include file=\"index.php\"}";

//the available resources to create the exploit are:
// php_funcions : isset,empty,count,sizeof,in_array,is_array,time
// php_modifiers : escape,count,nl2br
// streams: file
// allow_constants
// allow_super_globals
echo "lala\n";
foreach($smarty->security_policy->streams as $func){
    echo $func."\n";
}
echo "lala\n";

//echo $smarty->security_policy->php_functions;



$template_string = $user_in;
try{
    $smarty->display('string:'.$template_string); 
}
catch(Exception $e){
    echo "error: ".$e->getMessage();
}
